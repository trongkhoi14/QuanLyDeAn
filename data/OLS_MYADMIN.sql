--Tao bang thong bao
--DROP TABLE THONGBAO;

CONNECT MYADMIN/123;
CREATE TABLE THONGBAO (MATB VARCHAR2(10), NOIDUNG VARCHAR2(4000));

INSERT INTO MYADMIN.THONGBAO VALUES ('T1', 'DAY LA DONG THONG BAO THU NHAT');
INSERT INTO MYADMIN.THONGBAO VALUES ('T2', 'DAY LA DONG THONG BAO THU HAI');


--B2: TAO CAC THANH PHAN
--LEVEL
CONNECT MYADMIN/123;
EXEC SA_COMPONENTS.CREATE_LEVEL ('ACCESS_THONGBAO', 9000, 'GD', 'GIAMDOC');
EXEC SA_COMPONENTS.CREATE_LEVEL ('ACCESS_THONGBAO', 8000, 'TP', 'TRUONGPHONG');
EXEC SA_COMPONENTS.CREATE_LEVEL ('ACCESS_THONGBAO', 7000, 'NV', 'NHANVIEN');

--COMPARTMENT
CONNECT MYADMIN/123;
EXEC SA_COMPONENTS.CREATE_COMPARTMENT ('ACCESS_THONGBAO', 2000, 'MB', 'MUABAN');
EXEC SA_COMPONENTS.CREATE_COMPARTMENT ('ACCESS_THONGBAO', 3000, 'SX', 'SANXUAT');
EXEC SA_COMPONENTS.CREATE_COMPARTMENT ('ACCESS_THONGBAO', 4000, 'GC', 'GIACONG');

--GROUP
CONNECT MYADMIN/123;
EXEC SA_COMPONENTS.CREATE_GROUP ('ACCESS_THONGBAO', 1, 'B', 'MIENBAC', NULL);
EXEC SA_COMPONENTS.CREATE_GROUP ('ACCESS_THONGBAO', 2, 'T', 'MIENTRUNG', NULL);
EXEC SA_COMPONENTS.CREATE_GROUP ('ACCESS_THONGBAO', 3, 'N', 'MIENNAM', NULL);


--B3: TAO NHAN DU LIEU
CONNECT MYADMIN/123;
EXEC SA_LABEL_ADMIN.CREATE_LABEL('ACCESS_THONGBAO',1,'TP');
EXEC SA_LABEL_ADMIN.CREATE_LABEL('ACCESS_THONGBAO',100,'TP:SX:T');


--B4: GAN CHINH SACH CHO TABLE/ SCHEMA
CONNECT MYADMIN/123;
EXEC SA_POLICY_ADMIN.APPLY_TABLE_POLICY('ACCESS_THONGBAO','MYADMIN','THONGBAO','NO_CONTROL');

UPDATE MYADMIN.THONGBAO
SET OLS_THONGBAO = CHAR_TO_LABEL ('ACCESS_THONGBAO', 'TP')
WHERE MATB = 'T1';

UPDATE MYADMIN.THONGBAO
SET OLS_THONGBAO = CHAR_TO_LABEL ('ACCESS_THONGBAO', 'TP:SX:T')
WHERE MATB = 'T2';

EXEC SA_POLICY_ADMIN.REMOVE_TABLE_POLICY ('ACCESS_THONGBAO','MYADMIN','THONGBAO');
EXEC SA_POLICY_ADMIN.APPLY_TABLE_POLICY('ACCESS_THONGBAO','MYADMIN','THONGBAO','READ_CONTROL');


--B5: GAN NHAN CHO USER
-- Du lieu test
/*
ALTER SESSION SET "_ORACLE_SCRIPT"=TRUE;
CREATE USER GD1 IDENTIFIED BY 123;
CREATE USER GD2 IDENTIFIED BY 123;
CREATE USER TP1 IDENTIFIED BY 123;
CREATE USER NV1 IDENTIFIED BY 123;

GRANT CREATE SESSION TO GD1;
GRANT CREATE SESSION TO GD2;
GRANT CREATE SESSION TO TP1;
GRANT CREATE SESSION TO NV1;
GRANT SELECT ON MYADMIN.THONGBAO TO GD1, GD2, TP1, NV1;
*/

CONNECT MYADMIN/123;
EXEC SA_USER_ADMIN.SET_USER_LABELS (policy_name => 'ACCESS_THONGBAO', user_name => 'GD1', max_read_label => 'GD:MB,SX,GC:B,T,N');
EXEC SA_USER_ADMIN.SET_USER_LABELS (policy_name => 'ACCESS_THONGBAO', user_name => 'TP1', max_read_label => 'TP:SX:N');
EXEC SA_USER_ADMIN.SET_USER_LABELS (policy_name => 'ACCESS_THONGBAO', user_name => 'GD2', max_read_label => 'GD:MB,SX,GC:B');
